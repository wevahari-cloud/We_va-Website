{"version":3,"sources":["../../../../src/actions/gallery.ts","../../../../.next-internal/server/app/admin/gallery/page/actions.js%20%28server%20actions%20loader%29"],"sourcesContent":["\"use server\";\r\n\r\nimport { db } from \"@/db\";\r\nimport { gallery } from \"@/db/schema\";\r\nimport { eq, desc } from \"drizzle-orm\";\r\nimport { revalidatePath } from \"next/cache\";\r\n\r\nimport { events } from \"@/db/schema\";\r\nimport { isNotNull } from \"drizzle-orm\";\r\n\r\nexport async function getGalleryImages() {\r\n    try {\r\n        const images = await db.select().from(gallery).orderBy(desc(gallery.createdAt));\r\n        return images;\r\n    } catch (error) {\r\n        console.error(\"Failed to fetch gallery images:\", error);\r\n        return [];\r\n    }\r\n}\r\n\r\nexport async function getPublicGalleryImages() {\r\n    try {\r\n        // Fetch gallery images\r\n        const galleryImages = await db.select().from(gallery).orderBy(desc(gallery.createdAt));\r\n\r\n        // Fetch events with posters\r\n        const allEvents = await db.select({\r\n            id: events.id,\r\n            title: events.title,\r\n            imageUrl: events.posterUrl,\r\n            images: events.images,\r\n            category: events.category,\r\n            createdAt: events.createdAt,\r\n        })\r\n            .from(events)\r\n            .orderBy(desc(events.createdAt));\r\n\r\n        // Filter events that have a posterUrl OR additional images\r\n        const eventPosters = allEvents.filter(e =>\r\n            (e.imageUrl && e.imageUrl.trim() !== \"\") ||\r\n            (Array.isArray(e.images) && e.images.length > 0 && e.images.some((img: any) => typeof img === 'string' && img.trim() !== \"\"))\r\n        );\r\n\r\n        // Transform event posters to match gallery structure and prevent ID collisions (if any)\r\n        // Since we are just mapping them for display, we can use a composite ID or just rely on them being distinct enough for now\r\n        // But to be safe, let's cast them to a unified type.\r\n\r\n        // However, the cleanest way is just to combine them.\r\n        // Let's assume unique IDs across tables is NOT guaranteed (both serial).\r\n        // So we should map them to a display interface.\r\n\r\n        const combinedImages = [\r\n            ...galleryImages.map(img => ({ ...img, id: `gallery-${img.id}`, type: \"gallery\" })),\r\n            ...eventPosters.flatMap(evt => {\r\n                const items = [];\r\n                // Add poster\r\n                if (evt.imageUrl) {\r\n                    items.push({\r\n                        id: `event-${evt.id}-poster`,\r\n                        title: evt.title,\r\n                        imageUrl: evt.imageUrl as string,\r\n                        category: evt.category,\r\n                        createdAt: evt.createdAt,\r\n                        type: \"event\",\r\n                        eventId: evt.id,\r\n                    });\r\n                }\r\n\r\n                // Add additional images\r\n                // Ensure images is an array of strings\r\n                if (Array.isArray(evt.images)) {\r\n                    (evt.images as string[]).forEach((imgUrl, index) => {\r\n                        if (typeof imgUrl === 'string' && imgUrl.trim() !== \"\") {\r\n                            items.push({\r\n                                id: `event-${evt.id}-extra-${index}`,\r\n                                title: `${evt.title} - Photo ${index + 1}`,\r\n                                imageUrl: imgUrl,\r\n                                category: evt.category,\r\n                                createdAt: evt.createdAt,\r\n                                type: \"event\",\r\n                                eventId: evt.id,\r\n                            });\r\n                        }\r\n                    });\r\n                }\r\n\r\n                return items;\r\n            })\r\n        ];\r\n\r\n        // Sort combined list by createdAt desc\r\n        combinedImages.sort((a, b) => {\r\n            const dateA = new Date(a.createdAt || 0);\r\n            const dateB = new Date(b.createdAt || 0);\r\n            return dateB.getTime() - dateA.getTime();\r\n        });\r\n\r\n        return combinedImages;\r\n    } catch (error) {\r\n        console.error(\"Failed to fetch public gallery images:\", error);\r\n        return [];\r\n    }\r\n}\r\n\r\nexport async function addGalleryImage(data: {\r\n    title?: string;\r\n    imageUrl: string;\r\n    category?: string;\r\n}) {\r\n    try {\r\n        await db.insert(gallery).values(data);\r\n        revalidatePath(\"/gallery\");\r\n        revalidatePath(\"/admin/gallery\");\r\n        return { success: true };\r\n    } catch (error) {\r\n        console.error(\"Failed to add gallery image:\", error);\r\n        return { success: false, error: \"Database insert failed\" };\r\n    }\r\n}\r\n\r\nexport async function deleteGalleryImage(id: number) {\r\n    try {\r\n        await db.delete(gallery).where(eq(gallery.id, id));\r\n        revalidatePath(\"/gallery\");\r\n        revalidatePath(\"/admin/gallery\");\r\n        return { success: true };\r\n    } catch (error) {\r\n        console.error(\"Failed to delete gallery image:\", error);\r\n        return { success: false, error: \"Database delete failed\" };\r\n    }\r\n}\r\n","export {getGalleryImages as '00f9a7a584e89020dd5388211223be80bbf39d5ef5'} from 'ACTIONS_MODULE0'\nexport {deleteGalleryImage as '40a754ebeea1af3b68804c3a4b47560b936b735fdd'} from 'ACTIONS_MODULE0'\n"],"names":[],"mappings":"wDAEA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,OAAA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,OAKO,eAAe,IAClB,GAAI,CAEA,OADe,AACR,MADc,EAAA,EAAE,CAAC,MAAM,GAAG,IAAI,CAAC,EAAA,OAAO,EAAE,OAAO,CAAC,CAAA,EAAA,EAAA,IAAA,AAAI,EAAC,EAAA,OAAO,CAAC,SAAS,EAEjF,CAAE,MAAO,EAAO,CAEZ,OADA,QAAQ,KAAK,CAAC,kCAAmC,GAC1C,EAAE,AACb,CACJ,CAEO,eAAe,IAClB,GAAI,CAEA,IAAM,EAAgB,MAAM,EAAA,EAAE,CAAC,MAAM,GAAG,IAAI,CAAC,EAAA,OAAO,EAAE,OAAO,CAAC,CAAA,EAAA,EAAA,IAAA,AAAI,EAAC,EAAA,OAAO,CAAC,SAAS,GAe9E,EAAe,CAZH,MAAM,EAAA,EAAE,CAAC,MAAM,CAAC,CAC9B,GAAI,EAAA,MAAM,CAAC,EAAE,CACb,MAAO,EAAA,MAAM,CAAC,KAAK,CACnB,SAAU,EAAA,MAAM,CAAC,SAAS,CAC1B,OAAQ,EAAA,MAAM,CAAC,MAAM,CACrB,SAAU,EAAA,MAAM,CAAC,QAAQ,CACzB,UAAW,EAAA,MAAM,CAAC,SAAS,AAC/B,GACK,IAAI,CAAC,EAAA,MAAM,EACX,OAAO,CAAC,CAAA,EAAA,EAAA,IAAA,AAAI,EAAC,EAAA,MAAM,CAAC,SAAS,EAAA,EAGH,MAAM,CAAC,GACjC,EAAE,QAAQ,EAA0B,KAAtB,EAAE,QAAQ,CAAC,IAAI,IAC7B,MAAM,OAAO,CAAC,EAAE,MAAM,GAAK,EAAE,MAAM,CAAC,MAAM,CAAG,GAAK,EAAE,MAAM,CAAC,IAAI,CAAC,AAAC,GAA4B,UAAf,OAAO,GAAmC,KAAf,EAAI,IAAI,KAWhH,EAAiB,IAChB,EAAc,GAAG,CAAC,IAAQ,CAAE,CAAH,EAAM,CAAG,CAAE,GAAI,CAAC,QAAQ,EAAE,EAAI,EAAE,CAAA,CAAE,CAAE,KAAM,UAAU,CAAC,KAC9E,EAAa,OAAO,CAAC,IACpB,IAAM,EAAQ,EAAE,CAgChB,OA9BI,EAAI,QAAQ,EAAE,AACd,EAAM,IAAI,CAAC,CACP,GAAI,CAAC,MAAM,EAAE,EAAI,EAAE,CAAC,OAAO,CAAC,CAC5B,MAAO,EAAI,KAAK,CAChB,SAAU,EAAI,QAAQ,CACtB,SAAU,EAAI,QAAQ,CACtB,UAAW,EAAI,SAAS,CACxB,KAAM,QACN,QAAS,EAAI,EAAE,AACnB,GAKA,MAAM,OAAO,CAAC,EAAI,MAAM,GAAG,AAC1B,EAAI,MAAM,CAAc,OAAO,CAAC,CAAC,EAAQ,KAChB,UAAlB,OAAO,GAAyC,IAAI,CAAtB,EAAO,IAAI,IACzC,EAAM,IAAI,CAAC,CACP,GAAI,CAAC,MAAM,EAAE,EAAI,EAAE,CAAC,OAAO,EAAE,EAAA,CAAO,CACpC,MAAO,CAAA,EAAG,EAAI,KAAK,CAAC,SAAS,EAAE,EAAQ,EAAA,CAAG,CAC1C,SAAU,EACV,SAAU,EAAI,QAAQ,CACtB,UAAW,EAAI,SAAS,CACxB,KAAM,QACN,QAAS,EAAI,EAAE,AACnB,EAER,GAGG,CACX,GACH,CASD,OANA,EAAe,IAAI,CAAC,CAAC,EAAG,KACpB,IAAM,EAAQ,IAAI,KAAK,EAAE,SAAS,EAAI,GAEtC,OAAO,AADO,IAAI,KAAK,EAAE,SAAS,EAAI,GACzB,OAAO,GAAK,EAAM,OAAO,EAC1C,GAEO,CACX,CAAE,MAAO,EAAO,CAEZ,OADA,QAAQ,KAAK,CAAC,yCAA0C,GACjD,EAAE,AACb,CACJ,CAEO,eAAe,EAAgB,CAIrC,EACG,GAAI,CAIA,OAHA,MAAM,EAAA,EAAE,CAAC,MAAM,CAAC,EAAA,OAAO,EAAE,MAAM,CAAC,GAChC,CAAA,EAAA,EAAA,cAAA,AAAc,EAAC,YACf,CAAA,EAAA,EAAA,cAAA,AAAc,EAAC,kBACR,CAAE,SAAS,CAAK,CAC3B,CAAE,MAAO,EAAO,CAEZ,OADA,QAAQ,KAAK,CAAC,+BAAgC,GACvC,CAAE,QAAS,GAAO,MAAO,wBAAyB,CAC7D,CACJ,CAEO,eAAe,EAAmB,CAAU,EAC/C,GAAI,CAIA,OAHA,MAAM,EAAA,EAAE,CAAC,MAAM,CAAC,EAAA,OAAO,EAAE,KAAK,CAAC,CAAA,EAAA,EAAA,EAAA,AAAE,EAAC,EAAA,OAAO,CAAC,EAAE,CAAE,IAC9C,CAAA,EAAA,EAAA,cAAc,AAAd,EAAe,YACf,CAAA,EAAA,EAAA,cAAA,AAAc,EAAC,kBACR,CAAE,SAAS,CAAK,CAC3B,CAAE,MAAO,EAAO,CAEZ,OADA,QAAQ,KAAK,CAAC,kCAAmC,GAC1C,CAAE,QAAS,GAAO,MAAO,wBAAyB,CAC7D,CACJ,0CAxHsB,EAUA,EAoFA,EAgBA,IA9GA,CAAA,EAAA,EAAA,uBAAA,EAAA,EAAA,6CAAA,MAUA,CAAA,EAAA,EAAA,uBAAA,EAAA,EAAA,6CAAA,MAoFA,CAAA,EAAA,EAAA,uBAAA,EAAA,EAAA,6CAAA,MAgBA,CAAA,EAAA,EAAA,uBAAA,EAAA,EAAA,6CAAA,gJCxHtB,IAAA,EAAA,EAAA,CAAA,CAAA"}